(function(){function s(e){var t=document.createElement("div");t.textContent=e;return t.innerHTML}function a(e,t){var n=document.createElement("div");n.className="chat-message "+t;n.innerHTML=s(e);c.appendChild(n);c.scrollTop=c.scrollHeight;save()}function l(e,t,n){return new Promise(function(r){var i=document.createElement("div");i.className="typing-indicator "+t;i.innerHTML='<span>.</span><span>.</span><span>.</span>';c.appendChild(i);c.scrollTop=c.scrollHeight;setTimeout(function(){i.remove();a(e,t);r()},n*1000)})}function save(){localStorage.setItem(u,c.innerHTML)}function sendMsg(e){return fetch(o.n8nWebhookURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,uid:f})}).then(function(e){if(!e.ok)throw new Error("Erreur");return e.json()}).then(function(e){return e.reply||"Désolé, aucune réponse."}).catch(function(e){console.error(e);return"Une erreur est survenue."})}async function hS(){var e=i.value.trim();if(!e)return;a(e,"user");i.value="";var t=await sendMsg(e),n=Math.random()*4+2;await l(t,"bot",n)}async function initMsg(){var e=o.initialBotMessage;await l(e,"bot",2)}var fKey="conversationUID",f=localStorage.getItem(fKey);if(!f){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",h="";for(var j=0;j<40;j++)h+=g.charAt(Math.floor(Math.random()*g.length));f=h;localStorage.setItem(fKey,f)}var o=ChatbotConfig,c=document.getElementById("chat-window-body"),u="chatConversation",i=document.getElementById("chat-input"),n=document.getElementById("chat-bubble"),r=document.getElementById("help-text"),w=document.getElementById("chat-window"),x=document.getElementById("chat-close"),b=document.getElementById("chat-send");window.addEventListener("load",function(){setTimeout(function(){r.classList.add("show")},o.chatAppearanceDelay);var e=localStorage.getItem(u);e&&(c.innerHTML=e,c.scrollTop=c.scrollHeight)});n.addEventListener("click",function(){n.style.display="none";r.style.display="none";w.style.display="flex";i.focus();if(!c.innerHTML.trim())setTimeout(function(){initMsg()},o.chatAppearanceDelay)});x.addEventListener("click",function(){w.style.display="none";n.style.display="block"});b.addEventListener("click",hS);i.addEventListener("keypress",function(e){if(e.key==="Enter")hS()})})();
